# Automated Analysis Of Malicious Microsoft Office Documents

[Reference Paper Link](https://www.sciencedirect.com/science/article/pii/S0167404821004053?)


    Keywords:
    Malware
    Office documents
    Macro malware
    Powershell
    LOLBAS

- Abstract:

Cho đến nay, Microsoft Office có thể là bộ ứng dụng được sử dụng rộng rãi nhất để xử lý tài liệu, bảng tính và bản trình bày. Do tính phổ biến của nó, nó liên tục được sử dụng để thực hiện các chiến dịch độc hại. Các tác nhân đe dọa, khai thác các tính năng động của nền tảng, sử dụng nó để khởi động các cuộc tấn công và thâm nhập hàng triệu máy chủ trong chiến dịch của họ.
<br><br>
Công việc này khám phá bối cảnh hiện đại của các tài liệu Microsoft Office độc ​​hại, chỉ ra các phương tiện mà các tác giả phần mềm độc hại sử dụng. Chúng tôi tận dụng sự phân loại của các công cụ được sử dụng để xử lý các tài liệu Microsoft Office và khám phá hoạt động của các tác nhân độc hại. Hơn nữa, chúng tôi đã tạo và chia sẻ công khai một tập dữ liệu được chế tạo đặc biệt, dựa trên việc kết hợp các tài liệu lành tính và độc hại có chứa nhiều tính năng động như macro VBA và DDE. Điều sau là rất quan trọng cho một phân tích công bằng và thực tế, một vấn đề mở trong tình trạng nghệ thuật hiện nay. Điều này cho phép chúng tôi đưa ra kết luận an toàn về các tính năng và hành vi độc hại. Chính xác hơn, chúng tôi trích xuất các tính năng cần thiết bằng quy trình phân tích tự động để phân loại hiệu quả và chính xác tài liệu là lành tính hay độc hại bằng cách sử dụng máy học với điểm F1 trên 0,98, vượt trội so với các thuật toán phát hiện hiện đại nhất.

## 1. Introduction:

Microsoft Office cho đến nay vẫn là bộ ứng dụng văn phòng được sử dụng rộng rãi nhất. Các tài liệu được tạo ra từ bộ phần mềm không có nghĩa là tĩnh và chứa nhiều yếu tố động để làm cho chúng trở nên dễ chịu hơn về mặt thẩm mỹ, cung cấp các chức năng và tương tác nâng cao. Bản chất động của các phần tử được tăng cường thêm khi sử dụng ngôn ngữ lập trình VBA (Visual Basic for Applications). Tuy nhiên, nhiều lợi ích mà sự hỗ trợ từ một ngôn ngữ như vậy có thể mang lại nhưng phải trả một cái giá đắt. Lý do là kẻ thù có thể bọc giáp các tài liệu để tiến hành một cuộc tấn công. Trên thực tế, các tài liệu văn phòng độc hại được các thực thể độc hại sử dụng rộng rãi để phát tán phần mềm độc hại trên toàn thế giới, thường là thông qua email. Do được chuyển lại bởi nhiều nguồn khác nhau (Avira, 2020; ESET, 2020), tài liệu MS Office là định dạng tệp được phần mềm độc hại cho Windows sử dụng rộng rãi thứ hai và liên tục được sử dụng trong các chiến dịch malspam (Crowdstrike, 2020; Patsakis và Chrysanthou, 2020) .
<br><br>
Lý do chính mà các tệp này được sử dụng thường xuyên trong các chiến dịch như vậy là chúng được người dùng trao đổi liên tục. Do đó, người dùng có nhiều khả năng sẽ tải xuống và mở tệp MS Office mà họ nhận được, ngay cả từ một người gửi không xác định, ví dụ: tệp thực thi hoặc định dạng tệp “lạ”. Về vấn đề này, một tệp MS Office được kẻ thù sử dụng để đặt chân vào máy của nạn nhân và sau đó tiến hành lây nhiễm thực sự cho máy chủ. Trong khi AV có nhiều biện pháp kiểm tra cụ thể để ngăn chặn sự lây nhiễm từ các tệp như vậy, ngoài một số biện pháp kiểm soát được chế tạo đặc biệt từ MS cho phép người dùng cấp quyền thực thi một cách có chọn lọc, người dùng vẫn trở thành nạn nhân của các cuộc tấn công này. Đáng chú ý, một trong những phần mềm độc hại khét tiếng nhất trên toàn thế giới gần đây đã bị gỡ xuống Malwarebytes, Emotet, đang sử dụng các tài liệu MS Office bọc thép để lây nhiễm.

### 1.1. Motivation and contribution:

Mục tiêu của công việc này là thực hiện phân tích kỹ lưỡng các tài liệu MS Office độc ​​hại cho đến nay và thiết lập hiểu biết cơ bản về hoạt động mô-đun của chúng thông qua một cách tiếp cận tự động. Để đạt được mục tiêu này, chúng tôi đã thiết lập một quy trình tự động bao gồm một tập hợp các bước phân tích tài liệu cả tĩnh và động, đồng thời trích xuất một tập hợp các tính năng có thể được sử dụng để tạo điều kiện phân loại tài liệu từ lành tính đến độc hại.
<br><br>
Sự đóng góp của công việc này là rất nhiều. Phần lớn công việc trong các tài liệu MS Office độc ​​hại đang tập trung vào các tính năng có thể được sử dụng để phát hiện các tài liệu độc hại, nhưng không tập trung vào lý do thực tế tại sao chúng tồn tại. Trong bối cảnh này, chúng tôi thực sự tiết lộ những gì một tài liệu độc hại làm. Trái ngược với việc chỉ đơn giản nói rằng, ví dụ: chuỗi hex được sử dụng, thông qua thử nghiệm mở rộng, chúng tôi cho thấy rằng mặc dù có khả năng tiềm ẩn, nhưng các tài liệu MS Office độc ​​hại này thực sự là các ống nhỏ giọt; họ tải xuống và thực thi một tải trọng độc hại. Trong bối cảnh này, bài báo của chúng tôi là bài báo đầu tiên định lượng vấn đề thể hiện những phương tiện nào để thực hiện tải trọng bị giảm. Theo hiểu biết tốt nhất của chúng tôi, đây là bài báo đầu tiên trong tài liệu học thuật sử dụng giải mã để chỉ ra điều này trong khi hầu hết các tác giả chỉ đơn giản coi việc làm nhiễu loạn là một dấu hiệu của sự độc hại. Điều thứ hai có nghĩa là họ phát hiện ra triệu chứng nhưng không phát hiện ra nguyên nhân của nó. Ngoài ra, ngoài việc chỉ báo cáo LOLBAS / LOLBIN đã sử dụng, chúng tôi cho thấy sự đa dạng của các lựa chọn này cho thấy rằng một số giải pháp EDR và ​​EPP, mặc dù biết vectơ tấn công này không chặn chúng một cách hiệu quả. Điều sau biện minh cho tác động cao của các chiến dịch phần mềm độc hại sử dụng cách tiếp cận này.
<br><br>
Một đóng góp rất quan trọng cũng là tập dữ liệu mà chúng tôi đang sử dụng. Như chúng ta sẽ thảo luận sau trong bản thảo, các tập dữ liệu thiên vị, chẳng hạn như không bao gồm các tài liệu MS Office với mã VBA có thể dễ dàng thể hiện kết quả xuất sắc, nhưng trên thực tế, hoạt động khá kém. Ngược lại, tập dữ liệu của chúng tôi được tạo ra để ngăn chặn những thành kiến như vậy. Cái sau được sử dụng để xác định các tính năng không được sử dụng trong tài liệu, ví dụ: VBA stomping, DDE, v.v. cho phép chúng tôi phát hiện các mẫu phần mềm độc hại khai thác, ví dụ: lỗ hổng MS Office mới, không xác định tại thời điểm bài viết được gửi ban đầu . Phần sau minh họa rõ ràng hiệu quả và tiềm năng của phương pháp được đề xuất. Cuối cùng, các tính năng đã chọn và cách tiếp cận máy học rõ ràng vượt trội hơn so với công việc hiện có trong lĩnh vực này. Do các đặc điểm của tập dữ liệu này, để đảm bảo tính uy tín của kết quả của chúng tôi và để thúc đẩy nghiên cứu trong lĩnh vực này, tập dữ liệu được cung cấp trong Zenodo (Koutsokostas et al., 2021).
<br><br>
Trong phần tiếp theo, trước tiên chúng tôi cung cấp tổng quan về công việc liên quan đến phần mềm độc hại và tài liệu văn phòng. Cuối cùng, chúng tôi phân tích cấu trúc của chúng, các phương pháp được sử dụng để bọc giáp chúng, một số biện pháp đối phó và phương pháp phát hiện cũng như một số công cụ mã nguồn mở được sử dụng để xử lý các tệp MS Office. Sau đó, chúng tôi thảo luận về phương pháp của chúng tôi về thu thập, xử lý và phân tích dữ liệu. Sau đó, trong Phần 3, chúng tôi cung cấp tổng quan về tập dữ liệu của chúng tôi và một số phân tích khám phá về nội dung của nó. Phần 5 phân tích các phát hiện của chúng tôi và Phần 6 thảo luận về các phương pháp đã được xác định từ mỗi phần trong phương pháp của chúng tôi, cũng như hiệu quả và nhược điểm của chúng. Cuối cùng, bản thảo kết luận tóm tắt những phát hiện và đóng góp của chúng tôi.


